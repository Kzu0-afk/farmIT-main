{% extends 'base.html' %}
{% block content %}
<div class="bg-gradient-to-b from-amber-50 to-white min-h-screen">
  <div class="max-w-7xl mx-auto px-4 py-8">
    
    <!-- Header Section -->
    <div class="mb-8">
      <div class="flex items-center justify-between mb-6">
        <div>
          <h1 class="text-4xl font-bold text-gray-900 mb-2 flex items-center">
            <svg class="w-10 h-10 text-green-700 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            Farm Marketplace
          </h1>
          <p class="text-gray-600">Fresh produce directly from local farmers</p>
        </div>
        {% if user.is_authenticated and user.is_farmer %}
        <a href="/products/new/" class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-semibold px-6 py-3 rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition duration-200 flex items-center space-x-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          <span>New Listing</span>
        </a>
        {% endif %}
      </div>

      <!-- Search Section -->
      <div class="bg-white rounded-xl shadow-lg p-6 border-t-4 border-green-600">
        <form method="get" class="grid grid-cols-1 md:grid-cols-5 gap-4">
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
            <input 
              name="q" 
              placeholder="Search products..." 
              value="{{ query }}" 
              class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-transparent transition duration-200" 
            />
          </div>

          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </div>
            <input 
              name="location" 
              placeholder="Location..." 
              value="{{ location }}" 
              class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-transparent transition duration-200" 
            />
          </div>

          <input name="min_price" value="{{ min_price }}" placeholder="Min price" class="border border-gray-300 rounded-lg px-3 py-3 focus:ring-2 focus:ring-green-600 focus:border-transparent transition duration-200" />
          <input name="max_price" value="{{ max_price }}" placeholder="Max price" class="border border-gray-300 rounded-lg px-3 py-3 focus:ring-2 focus:ring-green-600 focus:border-transparent transition duration-200" />

          <button class="bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition duration-200 flex items-center justify-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <span>Search</span>
          </button>
        </form>
      </div>
    </div>

    {% if highlight_farms %}
    <!-- Marketplace highlights: top farms -->
    <div class="mt-8 mb-10">
      <h2 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
        <svg class="w-6 h-6 text-green-700 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.178c.969 0 1.371 1.24.588 1.81l-3.383 2.46a1 1 0 00-.364 1.118l1.287 3.966c.3.922-.755 1.688-1.54 1.118l-3.384-2.46a1 1 0 00-1.175 0l-3.384 2.46c-.784.57-1.838-.196-1.539-1.118l1.287-3.966a1 1 0 00-.364-1.118L2.997 9.394c-.783-.57-.38-1.81.588-1.81h4.178a1 1 0 00.95-.69l1.286-3.967z" />
        </svg>
        Top farms on FarmIT
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for farm in highlight_farms %}
        <a href="{% url 'farm_detail' slug=farm.slug %}" class="group bg-white rounded-2xl shadow-md hover:shadow-xl transition duration-300 border border-gray-200 hover:border-green-500 overflow-hidden">
          <div class="h-32 bg-gradient-to-r from-green-700 to-green-600 flex items-center justify-center text-white">
            <span class="text-xl font-bold group-hover:scale-105 transform transition">{{ farm.name }}</span>
          </div>
          <div class="p-4 space-y-2">
            {% if farm.location %}
            <div class="flex items-center text-xs text-gray-600">
              <svg class="w-4 h-4 mr-1 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              <span>{{ farm.location }}</span>
            </div>
            {% endif %}
            <div class="flex items-center justify-between text-xs text-gray-600">
              <div>
                <span class="font-semibold text-amber-500">
                  {% if farm.avg_rating %}
                  ★ {{ farm.avg_rating|floatformat:1 }}
                  {% else %}
                  ★ New
                  {% endif %}
                </span>
                <span class="ml-1 text-gray-400">
                  ({{ farm.review_count|default:0 }} review{{ farm.review_count|default:0|pluralize }})
                </span>
              </div>
              <div class="text-xs font-semibold text-green-700">
                {{ farm.active_products }} product{{ farm.active_products|pluralize }}
              </div>
            </div>
            {% if farm.top_products %}
            <div class="mt-2">
              <p class="text-[11px] uppercase tracking-wide text-gray-400 mb-1">Top products</p>
              <div class="flex flex-wrap gap-1">
                {% for fp in farm.top_products|slice:":3" %}
                <span class="inline-flex items-center px-2 py-0.5 rounded-full bg-green-50 text-[11px] text-green-800 border border-green-100">
                  {{ fp.product_name }}
                </span>
                {% endfor %}
              </div>
            </div>
            {% endif %}
          </div>
        </a>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Products Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for p in products %}
      <a href="/products/{{ p.id }}/" class="group block bg-white rounded-xl shadow-md hover:shadow-xl transition duration-300 overflow-hidden border border-gray-200 hover:border-green-500">
        <!-- Product Image Placeholder -->
        <div class="h-48 bg-gradient-to-br from-green-100 to-amber-50 flex items-center justify-center border-b border-gray-200">
          {% if p.photo_url %}
          <img src="{{ p.photo_url }}" alt="{{ p.product_name }}" class="w-full h-full object-cover" />
          {% else %}
          <svg class="w-20 h-20 text-green-600 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          {% endif %}
        </div>
        
        <div class="p-5">
          <h3 class="font-bold text-xl text-gray-900 mb-2 group-hover:text-green-700 transition duration-200">{{ p.product_name }}</h3>
          
          <div class="flex items-center justify-between mb-3">
            <div class="text-2xl font-bold text-green-700">₱{{ p.price }}</div>
            <div class="text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full">{{ p.quantity }} units</div>
          </div>
          
          <div class="flex items-center text-sm text-gray-600 mb-2">
            <svg class="w-4 h-4 mr-1 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            {{ p.location }}
          </div>
          
          <div class="flex items-center justify-between pt-3 border-t border-gray-200">
            <div class="flex items-center text-xs text-gray-500">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              {{ p.farmer.username }}
            </div>
            <div class="text-xs font-semibold text-green-600 group-hover:text-green-700">View Details →</div>
          </div>
        </div>
      </a>
      {% empty %}
      <div class="col-span-full text-center py-16">
        <svg class="w-24 h-24 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
        </svg>
        <p class="text-xl text-gray-500 mb-2">No products found</p>
        <p class="text-gray-400">Try adjusting your search filters</p>
      </div>
      {% endfor %}
    </div>

  </div>
</div>
{% endblock %}


